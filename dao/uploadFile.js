import fs from 'fs'
import path from 'path'
import {successStatus,errorStatus} from '../plugins/status'

// 上传图片
export function uploadImages (req,res) {
  // 上传之后文件的名称
  let filename = Date.now() + path.parse(req.files[0].originalname).ext
  // 上传成功后的文件路径
  let filePath = req.files[0].path
  fs.rename(filePath, path.join(path.dirname(filePath),filename), function(err){
    if(err){
      console.log(err)
      errorStatus.RESULT.msg = "上传失败"
      res.status(400).json(errorStatus.RESULT)
    }else{
      successStatus.RESULT = {
        msg :"上传成功",
        code: 200,
        data: {
          name: filename,
          objectUrl: "http://127.0.0.1:3000/file/" + filename
        }
      }
      res.status(200).json(successStatus.RESULT)
    }
  })
}
// 删除图片
export function removeImages (req,res) {
  let filename = req.params.name
  fs.unlink('../public/file/'+filename,(err) =>{
    if (err) throw err;
    successStatus.RESULT.msg = "删除成功"
    res.status(200).json(successStatus.RESULT)
  })
}